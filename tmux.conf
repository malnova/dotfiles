#####################################################
# P R É F É R E N C E S   G É N É R A L E S         #
#####################################################
#
# Il n'y a pas de fichier de configuration par défaut dans tmux.
# Un court exemple de fichier de configuration est disponible à l'adresse :
# https://github.com/tmux/tmux/blob/master/example_tmux.conf
# On peut aussi créer un fichier de configuration par défaut à partir des
# paramètres actuels avec l'instruction : tmux show -g > ~/.tmux.conf
# ou (avant la version 1.8) tmux show -g | cat > ~/.tmux.conf
#
# set est un alias pour set-option
# setw est un alias pour set-window-option

# Déclencher les événements corrects de focus, notamment pour vim
set-option -g focus-events on

# Délai entre deux commandes sans répéter le préfixe, en ms (défaut : 500)
# Vaut pour tous les raccourcis/keybinds définis avec l'option -r
set-option -g repeat-time 200

# Changer l'environnement pour permettre l'affichage des italiques
set-option -g default-terminal "tmux"

# Changer pour les touches spéciales
set-window-option -g xterm-keys on

# Nombre de lignes pour le scrollback (2000 par défaut)
# Dépend aussi du nombre de lignes fixé par URxvt dans ~/.Xresources
# ! Peut utiliser beaucoup de RAM si plusieurs fenêtres sont ouvertes !
set-option -g history-limit 8192

# Scrolling à la souris ou au touchpad
set-option -g mouse on
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi WheelUpPane send-keys -X halfpage-up
bind-key -T copy-mode-vi WheelDownPane send-keys -X halfpage-down
# En attendant de pouvoir faire ce qui suit ?
#bind-key -T emacs-copy -R5 WheelUpPane scroll-up
#bind-key -T emacs-copy -R5 WheelDownPane scroll-down

# Réduire le délai entre les changements de mode
set-option -sg escape-time 0


#####################################################
# K E Y B I N D S                                   #
#####################################################
#
# La touche "Ctrl" n'étant pas sensible à la casse, les combinaisons
# incluant C-S (Ctrl+Shift) sont impossibles.

# Changer le préfixe
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Diviser les fenêtres en utilisant les touches Préfixe+| et Préfixe+-
unbind '"'
unbind %
bind-key -r | split-window -h
bind-key -r - split-window -v

# Redimensionnement des panneaux (avec préfixe)
unbind C-Up
unbind C-Down
unbind C-Left
unbind C-Right
unbind M-Up
unbind M-Down
unbind M-Left
unbind M-Right
bind-key -r S-Up resize-pane -U
bind-key -r S-Down resize-pane -D
bind-key -r S-Left resize-pane -L
bind-key -r S-Right resize-pane -R

# Détacher un panneau
bind-key d break-pane
bind-key ! detach-client

# Fenêtres précédentes et suivantes (avec préfixe)
unbind n
unbind p
bind-key -r Right next-window
bind-key -r Left previous-window

# Entrer dans le mode "copie" avec Préfixe+Esc
unbind [
unbind ]
bind-key Escape copy-mode

# Permettre aux touches Home, End et Ctrl-Flèches de fonctionner en mode "copie"
bind-key -T copy-mode-vi Home send-keys 0
bind-key -T copy-mode-vi End send-keys $
bind-key -T copy-mode-vi C-Left send-keys -X previous-word
bind-key -T copy-mode-vi C-Right send-keys -X next-word

# Copier dans le clipboard (au lieu du buffer de tmux)
# Requiert l'installation du paquet xclip
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe "xclip -i -sel clip > /dev/null"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "xclip -i -sel clip > /dev/null"

# Liste des raccourcis claviers (fn-F1)
unbind ?
bind-key -n F1 list-keys

# Afficher l'heure
bind-key h clock-mode

# Fermer la session courante
unbind f
bind-key f kill-session


#####################################################
# C O U L E U R S                                   #
#####################################################
#
# Les couleurs possibles (cf. man tmux) sont : default, black, red, green,
# yellow, blue, magenta, cyan, white ainsi que certaines variantes avec
# "bright" (par ex. brightred, brightgreen...), les couleurs colour0 à
# colour255, ou les valeurs hexadécimalex RGB comme #ffffff.
#
# Pour obtenir la liste des couleurs de colour0 à colour255 dans bash :
# for i in {0..255};do printf "\x1b[38;5;${i}mcolour${i}\x1b[0m\n";done

# Délimitation des panneaux
set-option -g pane-border-style fg=colour239
set-option -g pane-active-border-style fg=green

# message text
set-option -g message-style bg=black,fg=brightred

# pane number display
set-option -g display-panes-active-colour blue
set-option -g display-panes-colour brightred

# Heure
set-window-option -g clock-mode-colour green


#####################################################
# B A R R E   D ' É T A T                           #
#####################################################

# Ne rien afficher dans la partie en bas à droite
set-option -g status-right ''

# Couleurs
set-option -g status-style bg=default,fg=yellow

# Couleurs par défaut pour le nom des fenêtres
set-window-option -g window-status-style bg=default,fg=brightblue

# Couleurs du nom de la fenêtre active
set-window-option -g window-status-current-style bg=default,fg=brightred


#####################################################
# P L U G I N   V I M   T M U X   N A V I G A T O R #
#####################################################
#
# https://github.com/christoomey/vim-tmux-navigator

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'S-Left' if-shell "$is_vim" 'send-keys S-Left'  'select-pane -L'
bind-key -n 'S-Down' if-shell "$is_vim" 'send-keys S-Down'  'select-pane -D'
bind-key -n 'S-Up' if-shell "$is_vim" 'send-keys S-Up'  'select-pane -U'
bind-key -n 'S-Right' if-shell "$is_vim" 'send-keys S-Right'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'S-Left' select-pane -L
bind-key -T copy-mode-vi 'S-Down' select-pane -D
bind-key -T copy-mode-vi 'S-Up' select-pane -U
bind-key -T copy-mode-vi 'S-Right' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l
